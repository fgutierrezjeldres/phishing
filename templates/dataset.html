<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Detector de Phishing | Dataset</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&family=Source+Sans+3:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link href="{{ url_for('static', filename='css/default/app.min.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='css/phishing-ui.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='plugins/datatables.net-bs4/css/dataTables.bootstrap4.min.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='plugins/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='plugins/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css') }}" rel="stylesheet" />
  </head>
  <body>
    {% set feature_keys = [
      'Formulario HTML', 'Contador De Dominio', 'Contador De Link', 'Contador De JavaScript',
      'Llamada de Accion', 'PAYPAL', 'BANK', 'Account', 'Numero de Reenvios', 'IP en URL',
      'Email Multipart', '@ en URL', 'Archivo Adjunto', 'Contenido HTML', 'Gmail', 'Outlook',
      'Flash', 'Hexadecimal', 'Hiperlink de Imagenes'
    ] %}
    {% set ns = namespace(phishy=0, legit=0) %}
    {% for row in resultado %}
      {% if row.get('Phishy') == 1 %}
        {% set ns.phishy = ns.phishy + 1 %}
      {% else %}
        {% set ns.legit = ns.legit + 1 %}
      {% endif %}
    {% endfor %}

    <div id="page-loader" class="fade show"><span class="spinner"></span></div>
    <div class="phish-shell">
      <section class="phish-head">
        <h2>Dataset Generado</h2>
        <small>Validación de características extraídas antes de entrenar la red neuronal.</small>
      </section>

      <section class="phish-kpis">
        <article class="phish-kpi primary">
          <p class="label">Total de muestras</p>
          <p class="value">{{ resultado|length }}</p>
        </article>
        <article class="phish-kpi danger">
          <p class="label">Clase phishing</p>
          <p class="value">{{ ns.phishy }}</p>
        </article>
        <article class="phish-kpi warn">
          <p class="label">Clase no phishing</p>
          <p class="value">{{ ns.legit }}</p>
        </article>
        <article class="phish-kpi ink">
          <p class="label">Balance</p>
          <p class="value">
            {% if ns.legit > 0 %}
              {{ '%.2f'|format(ns.phishy / ns.legit) }}
            {% else %}
              N/A
            {% endif %}
          </p>
        </article>
      </section>

      <div class="phish-card">
        <div class="card-header">Vista tabular de características</div>
        <div class="card-body">
          <p class="phish-note">
            Revisa rápidamente la distribución de indicadores antes de ejecutar el entrenamiento.
          </p>
          <div class="phish-table-wrap">
            <table id="dataset-table" class="table table-striped table-bordered table-hover m-b-0">
              <thead>
                <tr>
                  <th>#</th>
                  {% for key in feature_keys %}
                    <th class="text-nowrap">{{ key }}</th>
                  {% endfor %}
                  <th class="text-nowrap">Phishy</th>
                </tr>
              </thead>
              <tbody>
                {% for elemento in resultado %}
                  <tr>
                    <td>{{ loop.index }}</td>
                    {% for key in feature_keys %}
                      {% set val = elemento.get(key, 0) %}
                      <td><span class="phish-badge {{ 'on' if val == 1 else 'off' }}">{{ val }}</span></td>
                    {% endfor %}
                    <td>
                      <span class="phish-badge {{ 'on' if elemento.get('Phishy', 0) == 1 else 'off' }}">
                        {{ elemento.get('Phishy', 0) }}
                      </span>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <a href="{{ url_for('generacion_red_neuronal') }}" class="btn btn-primary phish-cta">Entrenar red neuronal</a>
        </div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/theme/default.min.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/datatables.net/js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/datatables.net-bs4/js/dataTables.bootstrap4.min.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/datatables.net-responsive/js/dataTables.responsive.min.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/datatables.net-buttons/js/dataTables.buttons.min.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/datatables.net-buttons/js/buttons.html5.min.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/datatables.net-buttons/js/buttons.print.min.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/pdfmake/build/pdfmake.min.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/pdfmake/build/vfs_fonts.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/jszip/dist/jszip.min.js') }}"></script>
    <script>
      $(function () {
        $("#dataset-table").DataTable({
          pageLength: 20,
          lengthMenu: [10, 20, 50, 100],
          scrollX: true,
          responsive: false,
          dom: "Bfrtip",
          buttons: ["copy", "csv", "excel", "print"],
          order: [[0, "asc"]],
          language: {
            search: "Buscar:",
            lengthMenu: "Mostrar _MENU_ filas",
            info: "Mostrando _START_ a _END_ de _TOTAL_",
            paginate: { previous: "Anterior", next: "Siguiente" }
          }
        });
      });
    </script>
  </body>
</html>
